<!DOCTYPE html>
<html lang="en">
<head>
{% load static %}

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title -->
    <title> Exampro Learning Dashboard HTML Template</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="{% static 'assets/images/logo/favicon.png'%}">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css'%}">
    <!-- file upload -->
    <link rel="stylesheet" href="{% static 'assets/css/file-upload.css'%}">
    <!-- file upload -->
    <link rel="stylesheet" href="{% static 'assets/css/plyr.css'%}">
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css">
    <!-- full calendar -->
    <link rel="stylesheet" href="{% static 'assets/css/full-calendar.css'%}">
    <!-- jquery Ui -->
    <link rel="stylesheet" href="{% static 'assets/css/jquery-ui.css'%}">
    <!-- editor quill Ui -->
    <link rel="stylesheet" href="{% static 'assets/css/editor-quill.css'%}">
    <!-- apex charts Css -->
    <link rel="stylesheet" href="{% static 'assets/css/apexcharts.css'%}">
    <!-- calendar Css -->
    <link rel="stylesheet" href="{% static 'assets/css/calendar.css'%}">
    <!-- jvector map Css -->
    <link rel="stylesheet" href="{% static 'assets/css/jquery-jvectormap-2.0.5.css'%}">
    <!-- Main css -->
    <link rel="stylesheet" href="{% static 'assets/css/main.css'%}">
</head> 
<body>
    
<!--==================== Preloader Start ====================-->
  <div class="preloader">
    <div class="loader"></div>
  </div>
<!--==================== Preloader End ====================-->

<!--==================== Sidebar Overlay End ====================-->
<div class="side-overlay"></div>
<!--==================== Sidebar Overlay End ====================-->

    <!-- ============================ Sidebar Start ============================ -->

    {% include 'aside.html' %}
  
<!-- ============================ Sidebar End  ============================ -->

    <div class="dashboard-main-wrapper">
        {% include 'navbar.html' %}

        <div class="dashboard-body">

            <div class="breadcrumb-with-buttons mb-24 flex-between flex-wrap gap-8">
                <!-- Breadcrumb Start -->
<div class="breadcrumb mb-24">
    <ul class="flex-align gap-4">
        <li><a href="index-3" class="text-gray-200 fw-normal text-15 hover-text-main-600">Home</a></li>
        <li> <span class="text-gray-500 fw-normal d-flex"><i class="ph ph-caret-right"></i></span> </li>
        <li><span class="text-main-600 fw-normal text-15">Students</span></li>
    </ul>
</div>
<!-- Breadcrumb End -->

                <!-- Breadcrumb Right Start -->
                <div class="flex-align gap-8 flex-wrap">
                    <div class="position-relative text-gray-500 flex-align gap-4 text-13">
                        <span class="text-inherit">Sort by: </span>
                        <div class="flex-align text-gray-500 text-13 border border-gray-100 rounded-4 ps-20 focus-border-main-600 bg-white">
                            <span class="text-lg"><i class="ph ph-funnel-simple"></i></span>
                            <select class="form-control ps-8 pe-20 py-16 border-0 text-inherit rounded-4 text-center">
                                <option value="1" selected>Popular</option>
                                <option value="1">Latest</option>
                                <option value="1">Trending</option>
                                <option value="1">Matches</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex-align text-gray-500 text-13 border border-gray-100 rounded-4 ps-20 focus-border-main-600 bg-white">
                        <span class="text-lg"><i class="ph ph-layout"></i></span>
                        <select class="form-control ps-8 pe-20 py-16 border-0 text-inherit rounded-4 text-center" id="exportOptions">
                            <option value="" selected disabled>Export</option>
                            <option value="csv">CSV</option>
                            <option value="json">JSON</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="card overflow-hidden">
                <div class="card-body p-0 overflow-x-auto">
                    <div id="loading">Loading...</div>
                    <p id="noResults" style="display: none;">No results found for the current user.</p>
    
                    <table id="resultsTable" border="1" style="display: none;" class="table table-striped">
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Total Questions</th>
                                <th>Correct Answers</th>
                                <th>Wrong Answers</th>
                                <th>Marks Percentage</th>
                                <th>User ID</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody">
                            
                            
                        </tbody>
                    </table>
                </div>
               
            </div>
            
        </div>
    </div>
    
        <!-- Jquery js -->
    <script src="{% static 'assets/js/jquery-3.7.1.min.js'%}"></script>
    <!-- Bootstrap Bundle Js -->
    <script src="{% static 'assets/js/boostrap.bundle.min.js'%}"></script>
    <!-- Phosphor Js -->
    <script src="{% static 'assets/js/phosphor-icon.js'%}"></script>
    <!-- file upload -->
    <script src="{% static 'assets/js/file-upload.js'%}"></script>
    <!-- file upload -->
    <script src="{% static 'assets/js/plyr.js'%}"></script>
    <!-- dataTables -->
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
    <!-- full calendar -->
    <script src="{% static 'assets/js/full-calendar.js'%}"></script>
    <!-- jQuery UI -->
    <script src="{% static 'assets/js/jquery-ui.js'%}"></script>
    <!-- jQuery UI -->
    <script src="{% static 'assets/js/editor-quill.js'%}"></script>
    <!-- apex charts -->
    <script src="{% static 'assets/js/apexcharts.min.js'%}"></script>
    <!-- jvectormap Js -->
    <script src="{% static 'assets/js/jquery-jvectormap-2.0.5.min.js'%}"></script>
    <!-- jvectormap world Js -->
    <script src="{% static 'assets/js/jquery-jvectormap-world-mill-en.js'%}"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- main js -->
    <script src="{% static 'assets/js/main.js'%}"></script>


   <script>
    document.addEventListener("DOMContentLoaded", function () {
    // Fetch logged-in user details and their results
    axios.get('/api/currentuser/', {
        headers: {
            Authorization: `Bearer ${localStorage.getItem('token')}`
        }
    })
    .then(userResponse => {
        const userId = userResponse.data.user_id;

        // Fetch exam results for the logged-in user
        axios.get(`/api/examresults/?user_id=${userId}`, {
            headers: {
                Authorization: `Bearer ${localStorage.getItem('token')}`
            }
        })
        .then(resultsResponse => {
            const results = resultsResponse.data;
            const tableBody = document.getElementById("resultsBody");

            if (results.length > 0) {
                let highestScoreRow = null;
                let highestScore = -1;

                results.forEach(result => {
                    const row = document.createElement("tr");

                    row.innerHTML = `
                        <td style="color:black;">${result.id}</td>
                        <td style="color:black;">${result.total_questions}</td>
                        <td style="color:black;">${result.correct_answers}</td>
                        <td style="color:black;">${result.wrong_answers}</td>
                        <td style="color:black;">${result.score_percentage}</td>
                        <td style="color:black;">${result.user}</td>
                    `;

                    // Append the row to the table body
                    tableBody.appendChild(row);

                    // Check if this row has the highest score
                    if (parseFloat(result.score_percentage) > highestScore) {
                        highestScore = parseFloat(result.score_percentage);
                        highestScoreRow = row;
                    }
                });

                // Apply additional styles to all <td> tags in the table
                const tdElements = document.querySelectorAll("#resultsTable td");
                tdElements.forEach(td => {
                    td.style.padding = "12px";
                    td.style.border = "1px solid #ddd";
                    td.style.textAlign = "center";
                    td.style.transition = "background-color 0.3s, color 0.3s";
                });

                // Highlight the highest score row
                if (highestScoreRow) {
                    const highestScoreCells = highestScoreRow.querySelectorAll("td");
                    highestScoreCells.forEach(td => {
                        td.style.backgroundColor = "#d4edda";
                        td.style.color = "#155724";
                        td.style.fontWeight = "bold";
                    });
                }

                document.getElementById("resultsTable").style.display = "table";
            } else {
                document.getElementById("noResults").style.display = "block";
            }

            document.getElementById("loading").style.display = "none";
        })
        .catch(error => {
            console.error("Error fetching results:", error);
            alert("Failed to fetch exam results.");
        });
    })
    .catch(error => {
        console.error("Error fetching current user:", error);
        alert("Failed to fetch user details.");
    });
});

   </script>
</body>
</html>
