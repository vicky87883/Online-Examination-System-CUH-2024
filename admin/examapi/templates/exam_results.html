<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Results</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Exam Results</h1>

    <table border="1" id="resultsTable" style="display: none;">
        <thead>
            <tr>
                <th>Student Name</th>
                <th>Roll Number</th>
                <th>Subject</th>
                <th>Marks Obtained</th>
                <th>Total Marks</th>
                <th>Result Date</th>
            </tr>
        </thead>
        <tbody id="resultsBody">
            <!-- Results will be dynamically inserted here -->
        </tbody>
    </table>
    <div id="noResults" style="display: none;">No results found for this user.</div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // API endpoint for fetching exam results
            const apiUrl = 'http://127.0.0.1:8000/api/examresults/'; // Replace with your API endpoint

            // API endpoint to get the current logged-in user ID (update according to your setup)
            const userApiUrl = 'http://127.0.0.1:8000/api/current_user/'; // Replace with the actual endpoint

            // Step 1: Fetch the current logged-in user's ID
            axios.get(userApiUrl)
                .then(userResponse => {
                    const currentUserId = userResponse.data.id; // Assuming the API returns the user ID in `id`

                    // Step 2: Fetch the exam results
                    axios.get(apiUrl)
                        .then(response => {
                            const results = response.data;

                            // Step 3: Filter results for the current user
                            const userResults = results.filter(result => result.user === currentUserId);

                            if (userResults.length > 0) {
                                const tableBody = document.getElementById("resultsBody");

                                // Populate the table with results for the current user
                                userResults.forEach(result => {
                                    const row = document.createElement("tr");

                                    row.innerHTML = `
                                        <td>${result.student_name}</td>
                                        <td>${result.roll_number}</td>
                                        <td>${result.subject}</td>
                                        <td>${result.marks_obtained}</td>
                                        <td>${result.total_marks}</td>
                                        <td>${result.result_date}</td>
                                    `;

                                    tableBody.appendChild(row);
                                });

                                // Display the table
                                document.getElementById("resultsTable").style.display = "table";
                            } else {
                                // Show "No Results" message
                                document.getElementById("noResults").style.display = "block";
                            }
                        })
                        .catch(error => {
                            console.error("Error fetching results:", error);
                            alert("Failed to fetch results. Please try again later.");
                        });
                })
                .catch(error => {
                    console.error("Error fetching user info:", error);
                    alert("Failed to fetch user info. Please ensure you are logged in.");
                });
        });
    </script>
</body>
</html>
